"use strict";define("wixCode/utils/wixCodeWidgetService",["lodash","wixCodeInit"],function(e,t){function i(e){return t.specMapUtils.getAppSpec(e)}function n(e){return!!i(e)}return{hasWixCodeWidgetSpecs:n,getWixCodeSpec:i}}),define("wixCode/aspects/WixCodeWidgetAspect",["lodash","wixCodeInit","coreUtils"],function(e,t,i){function n(e){this._aspectSiteAPI=e,this._aspectSiteAPI.registerToSiteReady(function(){var e=this._aspectSiteAPI.getSiteAspect("siteMembers");this.callbackId=e.registerToUserLogin(function(){this.isAppInitiated()||this.initApp(),e.unRegisterToUserLogin(this.callbackId)}.bind(this))}.bind(this))}return n.prototype={initApp:function(){var n=this._aspectSiteAPI.getSiteData(),o=this._aspectSiteAPI.getWixCodeAppApi(),r=e.get(n,["currentUrl","query","viewerPlatformAppSources"]),s=t.appsUtils.getAppsBaseInfo({rendererModel:n.rendererModel,clientSpecMap:n.getClientSpecMap(),serviceTopology:n.serviceTopology,viewerPlatformAppSources:r}),a=i.urlUtils.joinURL(n.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"lib/wix.min.js");o.init(n,n.getClientSpecMap(),{isMobileView:n.isMobileView(),debug:n.isDebugMode(),sdkSource:e.get(n,["currentUrl","query","sdkSource"])||a,runtimeSource:e.get(n,["currentUrl","query","WixCodeRuntimeSource"]),ReactSource:e.get(n,["currentUrl","query","ReactSource"]),applications:s})},isAppInitiated:function(){return this._aspectSiteAPI.getWixCodeAppApi().isAppInitiated()}},n}),define("wixCode/handlers/wixCodeHandlers",["lodash","zepto","utils","siteUtils"],function(e,t,i,n){var o=function(e,t){return e.getSiteData().findDataOnMasterPageByPredicate(function(e){return e.pageUriSEO===t||e.id===t})},r=function(e,t){var i,n=void 0!==window.screenLeft?window.screenLeft:window.screen.left,o=void 0!==window.screenTop?window.screenTop:window.screen.top;return i=window.innerWidth?window.innerWidth:window.document.documentElement.clientWidth?window.document.documentElement.clientWidth:window.screen.width,{top:(window.innerHeight?window.innerHeight:window.document.documentElement.clientHeight?window.document.documentElement.clientHeight:window.screen.height)/2-t/2+o,left:i/2-e/2+n}},s=function(e){return!!e.getRenderFlag("isExternalNavigationAllowed")||(e.getRenderRealtimeConfigItem("previewTooltipCallback")(r(50,20),"text_editor_inactive_link_on_preview"),!1)},a=function(t,i){var n={pageId:t.getSiteData().getPrimaryPageId()};if(i.pageId)if("#"===i.pageId)e.assign(n,{pageId:t.getSiteData().getMainPageId()});else{var r=o(t,i.pageId);e.assign(n,{pageId:"masterPage"===r.id?n.pageId:r.id})}if(i.routerId){var s=e.get(t.getSiteData(),["routers","configMap",i.routerId]),a=i.innerRoute?s.prefix+"/"+i.innerRoute:s.prefix;s&&(n={routerDefinition:s,innerRoute:i.innerRoute,pageAdditionalData:a})}i.anchorDataId&&e.assign(n,{anchorData:i.anchorDataId}),i.queryParams&&e.assign(n,{queryParams:i.queryParams}),t.handleNavigation(n,"#",!0)},c=function(e,t){var i=e.getSiteAspect("siteMembers");i.isLoggedIn()?i.getMemberDetails(t,function(e){t(null,e)}):t(null,"No user is currently logged in")};return{reportBI:function(e,t){e.reportBI(t.reportDef,t.params)},windowBoundingRect:function(e,t,i){var n=e.getSiteAspect("windowScrollEvent");i({window:e.getWindowSize(),scroll:n.getScrollPosition(),document:e.getDocumentSize()})},navigateTo:function(e,t){switch(t.data.type){case"ExternalLink":t.data.url&&s(e)&&window.open(t.data.url,"_self");break;case"EmailLink":var i=n.linkUtils.getEmailLink(t.data);i&&s(e)&&window.open(i,"_self");break;case"PhoneLink":window.open(n.linkUtils.getPhoneLink(t.data),"_self");break;case"DocumentLink":var o=n.linkUtils.getDocumentLink(t.data,e.getSiteData());window.open(o,"_self");break;default:a(e,t.data)}},postHtmlMessage:function(e,t){var i=t.data;e.getSiteAspect("HtmlPostMessageAspect").postMessage(i.id,i.msg)},openLightbox:function(e,t,i){var n=t.data.id,o=e.getSiteAspect("PopupPageAspect");e.getRuntimeDal().setPopupContext(n,t.data.context),i&&o.registerCloseHandler(n,i),o.openPopupPage(n)},closeLightbox:function(e,t){var i=t.data.id;e.getCurrentPopupId()===i&&e.getSiteAspect("PopupPageAspect").closePopupPage(t.data.returnedData)},getRoutersSiteMap:function(t,n,o){var r=t.getSiteData(),s=e.find(r.routers.configMap,{prefix:n.data.prefix})||{},a=i.routersBackEndRequests.makeParamObjFromSiteData(r,s,{});i.routersBackEndRequests.getInnerRoutesSiteMap(a,function(e){o(e)},e.noop)},startFileUpload:function(e,t,i){e.getComponentById(t.data.compId).uploadFiles(i)},getCurrentGeolocation:function(t,i,n){window.navigator.geolocation.getCurrentPosition(function(t){n({timestamp:e.get(t,"timestamp"),coords:e.toPlainObject(e.get(t,"coords"))})},function(e){n(null,e&&e.message)})},scrollToComponent:function(e,t,i){e.scrollToComponent(t.data.compId,{onComplete:function(){i()}})},scrollTo:function(t,i,n){t.getSiteAspect("windowScrollEvent").scrollSiteTo(i.data.x,i.data.y,e.isFunction(n)&&function(e){n(e)})},smCurrentUserEmail:function(t,i,n){c(t,function(t,i){i?n(null,i):e.isObject(t)&&t.email?n(t.email):n(null,"Unable to retrieve user email")})},smLogout:function(e,t,i){var n=e.getSiteAspect("siteMembers");n.isLoggedIn()?n.logout(null,i,function(e){i(null,e)}):i(null,"No member is logged in")},smForgotPassword:function(t,i,n){var o=e.get(i,["data","language"]),r=t.getSiteAspect("siteMembers"),s=!1;r.isLoggedIn()?n(null,"User is already logged in"):r.showResetPasswordDialog(o||null,function(){s=!0},function(){s?n():n(null,"The user closed the forgot password dialog")})}}}),define("wixCode/services/platformTpaApiService",["lodash","pmrpc","utils"],function(e,t,i){function n(e,n,o,r,s){return t.api.request("publicApi",{initiator:n}).then(function(t){if(!t[o])throw new Error("Api for component with id "+e+" does not contain function "+o);return t[o].apply(t,r)}).then(function(e){e&&s(e)}).catch(function(e){i.log.error(e.message),s(null,e.message)})}function o(e){var t=e.getIframe();return t&&t.id}function r(t,r,s){var a=t.getSiteAspect("tpaComponentsDomAspect"),c=e.get(r.data,"compId");a.getComponentWhenReady(c).then(function(t){if(!t)throw new Error("comp "+c+" does not exist");var i=e.get(r.data,"fn"),a=e.get(r.data,"fnArgs");switch(r.type){case"invokeAppFn":n(c,o(t),i,a,s);break;case"invokeAppOn":n(c,o(t),i,[s],s)}}).catch(function(e){i.log.error(e.message),s(null,e.message)})}return{handleAppAPIMessage:r}}),define("wixCode/utils/constants",[],function(){return{MESSAGE_INTENT:{WIX_CODE_MESSAGE:"WIX_CODE",WIX_CODE_SITE_API:"WIX_CODE_SITE_API",WIX_CODE_APP_API:"WIX_CODE_APP_API"},MESSAGE_TYPE:{CONSOLE:"console",IFRAME_COMMAND:"wix_code_iframe_command",GOOGLE_ANALYTICS:"googleAnalytics"}}}),define("wixCode/services/wixCodeUserScriptsService",["lodash","coreUtils"],function(e,t){function i(t,i){var n=e.get(i,"wixCode.fileCacheKillers",{}),o=e.get(i,"wixCode.defaultFileCacheKiller"),r=n["public/"+u+"/"+t];return r||o}function n(){return"https:"}function o(e,t,o,r,s){var a=n()+"//"+r.instanceId+"."+s.serviceTopology.wixCloudBaseDomain;return d.joinURL(a,u,e)+"?empty-if-missing=true&exclude=wix-&module-name="+t+"&viewMode="+s.viewMode+"&instance="+r.instance+"&scari="+o.signedAppRenderInfo+"&cacheKiller="+i(e,s)}function r(e,t,i,o,r){var s=n()+"//"+o.instanceId+".static."+r.serviceTopology.wixCloudBaseDomain;return d.joinURL(s,"static","v2",i.appData.codeAppId,o.instanceId,u,e)+"?empty-if-missing=true&exclude=wix-&module-name="+t}function s(e,t,i,n,s){return"site"===s.viewMode?r(e,t,i,n,s):o(e,t,i,n,s)}function a(e){return"masterPage"===e.type?"site":e.displayName+" "+("Popup"===e.type?"popup":"page")}function c(e,t,i,n){var o="masterPage"===e.type?"masterPage":e.id,r=o+".js";return{url:s(r,o,t,i,n),displayName:a(e),scriptName:r}}var d=t.urlUtils,u="pages";return{getUserScript:c}}),define("wixCode/utils/messageBuilder",["lodash","wixCode/services/wixCodeUserScriptsService","wixCode/utils/constants"],function(e,t,i){function n(e,i,n,o,r){if("load_widgets"===e.type||"load_user_code"===e.type){var s={appConfig:{scari:n.signedAppRenderInfo,instance:o.instance}};return"Application"!==i.type&&(s.appConfig.userScript=t.getUserScript(i,n,o,r)),s}}function o(e){return"Application"!==e.type||"dataBinding"===e.id}function r(t,r,s,a){var c={intent:i.MESSAGE_INTENT.WIX_CODE_MESSAGE};return s&&t.widgets&&(t.widgets=e.map(t.widgets,function(i){return o(i)?e.assign({},i,n(t,i,r,s,a)):i})),e.defaults({},t,c)}return{getExtendedMessage:r}}),define("wixCode/aspects/wixCodePostMessageService",["lodash","tpa","utils","wixCode/handlers/wixCodeHandlers","wixCode/services/platformTpaApiService","wixCode/utils/constants","wixCode/utils/messageBuilder","wixCode/utils/wixCodeWidgetService","widgets"],function(e,t,i,n,o,r,s,a,c){function d(e){return e===r.MESSAGE_INTENT.WIX_CODE_MESSAGE}function u(e){return e===r.MESSAGE_INTENT.WIX_CODE_SITE_API}function l(e){return e===r.MESSAGE_INTENT.WIX_CODE_APP_API}function g(e){return c.widgetService.getWidgetHandler(e)}function p(e,t,n){var o=g(e);switch(t.type){case r.MESSAGE_TYPE.IFRAME_COMMAND:o.onCommand(t,n);break;case r.MESSAGE_TYPE.CONSOLE:i.logWixCodeConsoleMessage(t);break;case r.MESSAGE_TYPE.GOOGLE_ANALYTICS:i.logger.reportGoogleAnalytics.apply(null,[e.getSiteData()].concat(t.data));break;default:o.handleRemoteMessage(t)}}function f(i,r,s){try{e.isString(r)&&(r=JSON.parse(r))}catch(e){return}if(r){var a;if(d(r.intent))s(r,m(r,g(i)));else if(u(r.intent)){var c=e.defaults({},n,t.tpaHandlers);if(a=m(r,g(i)),c[r.type])try{c[r.type](i,r,a)}catch(e){a(null,e.message)}}else if(l(r.intent)){a=m(r,g(i));try{o.handleAppAPIMessage(i,r,a)}catch(e){a(null,e.message)}}}}function m(t,i){return function(n,o){var r={intent:"WIX_CODE_RESPONSE",callbackId:t.callbackId,type:t.type,contextId:t.contextId};r=u(t.intent)||l(t.intent)?e.merge(r,{result:n,error:o}):e.merge(r,{result:{compId:t.compId,command:t.command}});try{i.updateComponent(r)}catch(e){}}}function w(t,i,n){f(t,i,n||e.partial(p,t))}function C(e,t){var i=e.getSiteData(),n=i.rendererModel.wixCodeModel,o=a.getWixCodeSpec(i.getClientSpecMap());return s.getExtendedMessage(t,n,o,i)}function S(t,i){c.widgetService.registerWidgetMessageHandler(t,e.partial(i,t))}function h(t,i){c.widgetService.registerWidgetMessageModifier(t,e.partial(i,t))}return{handleMessage:w,modifyPostMessage:C,registerMessageHandler:S,registerMessageModifier:h}}),define("wixCode/aspects/WixCodePostMessageAspect",["wixCode/aspects/wixCodePostMessageService"],function(e){return function(t){this.siteAPI=t,e.registerMessageHandler(this.siteAPI,e.handleMessage),e.registerMessageModifier(this.siteAPI,e.modifyPostMessage)}}),define("wixCode/aspects/hooksHandlers/matrixGalleryDataHook",["lodash","galleriesCommon","coreUtils"],function(e,t,i){function n(e,t,i){if("ImageList"===t.value.type){var n=this.siteAPI.getRuntimeDal(),s=n.getCompData(e),a=n.getCompProps(e),c=n.getCompLayout(e),d=n.getCompStructure(e),u=i.items,l=s.items,g=c.height,p=r.getAvailableRowsNumber(a.maxRows,a.numCols,u.length),f=r.getAvailableRowsNumber(a.maxRows,a.numCols,l.length),m=Math.max(o.MIN_GALLERY_HEIGHT,o.getGalleryHeight(p,f,a.margin,d.skin,g));n.updateCompLayout(e,{height:m})}}var o=t.utils.galleriesHelperFunctions,r=i.matrix.calculations;return{setCompLayoutOnDataChange:n}}),define("wixCode/aspects/wixCodeChangeHooksAspect",["lodash","wixCode/aspects/hooksHandlers/matrixGalleryDataHook"],function(e,t){function i(e){this.siteAPI=e,this.DATA="dataChange",this.compsPlugin={dataChange:{}},e.getRuntimeDal().registerChangeListener(this.handleRuntimeDalCompChange.bind(this)),this.registerListeners()}return i.prototype={getSiteAPI:function(){return this.siteAPI},getPlugin:function(e,t){return this.compsPlugin[e.type]&&this.compsPlugin[e.type][t]?this.compsPlugin[e.type][t]:null},handleRuntimeDalCompChange:function(e,t,i){var n=this.getSiteAPI().getRuntimeDal().getCompStructure(e);if(t&&n&&n.componentType){var o=this.getPlugin(t,n.componentType);o&&o.call(this,e,t,i)}},registerListeners:function(){this.registerCompListener(this.DATA,"wysiwyg.viewer.components.MatrixGallery",t.setCompLayoutOnDataChange)},registerCompListener:function(e,t,i){this.compsPlugin[e][t]=i}},i}),define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect","wixCode/aspects/wixCodeChangeHooksAspect"],function(e,t,i,n){var o=e.siteAspectsRegistry;o.registerSiteAspect("wixCodeWidgetAspect",t),o.registerSiteAspect("wixCodePostMessageAspect",i),o.registerSiteAspect("wixCodeChangeHooksAspect",n)}),define("wixCode/utils/kibanaReporter",["lodash","utils"],function(e,t){function i(t){w=t||e.noop}function n(e,i){var n={type:"POST",url:e+"/logstash/events",dataType:"json",contentType:"application/json",data:JSON.stringify(i)};return new Promise(function(e,i){n.success=e,n.error=function(e,t,n){i({xhr:e,errorType:t,error:n})},t.ajaxLibrary.ajax(n)})}function o(e,t,i){if(!("undefined"==typeof window||window&&window.disableKibanaReporting||s())){i||(i=1);var a=u(e);n(t,a).then(w,function(){i>2?r(a):o(e,t,i+1),w()})}}function r(t){var i,n=window.localStorage.getItem("wixCodePendingMonitoring");try{var o=n?JSON.parse(n):[];i=e.isArray(o)?o:[]}catch(e){i=[]}var r=JSON.stringify(i.concat(t));try{window.localStorage.setItem("wixCodePendingMonitoring",r)}catch(e){}}function s(){var t=e.get(window,"location.href","");return e.includes(t,"://localhost")}function a(t){var i=function(e){var t=m.exec(e);if(t&&t[1])return t[1]}(function(t){if(!t)return"";if(!e.isString(t))return t;try{return JSON.parse(t)}catch(e){return""}}(t.message).errorDescription);return i?e.assign({},t,{requestId:i}):t}function c(t){return e.isError(t.message)?e.assign({},t,{message:function(e){return e.stack?e.stack:e.toString()}(t.message)}):t}function d(t){return e.isString(t.message)?t:e.assign({},t,{message:JSON.stringify(t.message)})}function u(t){return e.flow(c,a,d)(t)}function l(){return{source:"wix-code-client",level:f.INFO,userActionId:t.guidUtils.getGUID()}}function g(t){if(!e.isString(t)||0===t.length)throw new Error("parameter `baseUrl` is invalid, received: "+t)}function p(t,i){g(i);var n=new Date,r=n.getTime(),s=e.assign({},l(),t,{timestamp:n.toJSON(),actionPosition:"start"});return o(s,i),function(t){var n=new Date,a=(n.getTime()-r)/1e3;o(t=e.assign({},s,t,{timestamp:n.toJSON(),duration:a,actionPosition:"end"}),i)}}var f={INFO:"info",ERROR:"error"},m=/\[request-id:\s(\d+\.\d+)\]/,w=e.noop;return{levels:f,trace:p,_setResponseCallback:i}}),define("wixCode",["wixCode/utils/wixCodeWidgetService","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/messageBuilder","wixCode/utils/kibanaReporter","wixCode/aspects/wixCodePostMessageService"],function(e,t,i,n,o){return{wixCodeWidgetService:e,log:n,messageBuilder:i,wixCodePostMessageService:o}});
//# sourceMappingURL=wixCode.min.js.map